<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>游戏角色行走</title>
</head>

<body>
    <div class="box">
        <img class="girl" src="./assets/girl.png">
    </div>
</body>

<script type="module">
    import { walkConfig } from './action/walk.ts';
    // 每张图片宽48，高96 一个方向的动作有8帧，总共四个方向
    window.addEventListener('load', () => {
        // const offsetArr = new Array(8); // 存储偏移值
        let offsetArr = ''; // 存储偏移值
        let offsetValue = 0;
        let judge = true;
        let timer;

        // 0 96 192 288
        const box = document.querySelector('.box');
        const girl = document.querySelector('.girl')

        // const walkDir = {
        //     w:0, // 上偏移
        //     s:0, // 下偏移
        //     a:0, // 左偏移
        //     d:0,  // 右偏移
        // }

        // 这样写的话 停下的话展示永远是第一张图片
        // function downWalk () {
        //     for(let i=0;i<offsetArr.length;i++) {
        //         offsetArr[i] = -walkDir.s + 'px';
        //         walkDir.s += 48; // 宽度48吧 需要一直切换
        //         // 图片运行到最后一张时，回到第一张
        //         if(walkDir.s>=48*7) {
        //             walkDir.s = 0; 
        //         }
        //         if(girl) {
        //             console.log('触发')
        //          girl.style.marginLeft = offsetArr[i];
        //      }
        //     }
        // }


        function run() {
            offsetArr = -walkDir.s + 'px';
            walkDir.s += 48;
            if (walkDir.s >= 48 * 7) {
                walkDir.s = 0;
            }
            if (girl) {
                girl.style.marginLeft = offsetArr;
            }
        }

        function endMove() {
            if (timer) {
                clearInterval(timer)
            }
        }
        window.addEventListener('keyup', (event) => {
            endMove();
            judge = true;
        })

        window.addEventListener('keydown', (event) => {
            if (!girl) return;
            // 这个switch 用来调整人物面对的方向
            switch (event.keyCode) {
                case 87: // 上
                    girl.style.marginTop = -288 + 'px';
                    break;
                case 83: // 下
                    girl.style.marginTop = 0 + 'px';
                    break;
                case 65: // 左
                    girl.style.marginTop = -96 + 'px';
                    break;
                case 68: // 右
                    girl.style.marginTop = -192 + 'px';
                    break;
            }
            if (judge) {
                timer = setInterval(run, 80);
                judge = false;
            }
        })











    })    
</script>

<style>
    .box {
        width: 48px;
        height: 96px;
        overflow: hidden;
    }
</style>

</html>